<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
<meta charset="utf-8">
<title>Fusion Level02 - Exploit Exercises</title>
<meta name="author" content="Exploit Exercises">

<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://exploit-exercises.com/fusion/level02">
<link href="/favicon.png" type="image/png" rel="icon">

;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">op</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">size_t</span> <span class="n">sz</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">loop</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;[-- Enterprise configuration file encryption service --]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">loop</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="k">while</span><span class="p">(</span><span class="n">loop</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">nread</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">op</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">op</span><span class="p">));</span>
</span><span class='line'>      <span class="k">switch</span><span class="p">(</span><span class="n">op</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;E&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="n">nread</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sz</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sz</span><span class="p">));</span>
</span><span class='line'>              <span class="n">nread</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">sz</span><span class="p">);</span>
</span><span class='line'>              <span class="n">cipher</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">sz</span><span class="p">);</span>
</span><span class='line'>              <span class="n">printf</span><span class="p">(</span><span class="s">&quot;[-- encryption complete. please mention &quot;</span>
</span><span class='line'>              <span class="s">&quot;474bd3ad-c65b-47ab-b041-602047ab8792 to support &quot;</span>
</span><span class='line'>              <span class="s">&quot;staff to retrieve your file --]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>              <span class="n">nwrite</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sz</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">sz</span><span class="p">));</span>
</span><span class='line'>              <span class="n">nwrite</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">sz</span><span class="p">);</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">case</span> <span class="sc">&#39;Q&#39;</span><span class="o">:</span>
</span><span class='line'>              <span class="n">loop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>              <span class="k">break</span><span class="p">;</span>
</span><span class='line'>          <span class="k">default</span><span class="o">:</span>
</span><span class='line'>              <span class="n">exit</span><span class="p">(</span><span class="n">EXIT_FAILURE</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">envp</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">fd</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">background_process</span><span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">UID</span><span class="p">,</span> <span class="n">GID</span><span class="p">);</span> 
</span><span class='line'>  <span class="n">fd</span> <span class="o">=</span> <span class="n">serve_forever</span><span class="p">(</span><span class="n">PORT</span><span class="p">);</span>
</span><span class='line'>  <span class="n">set_io</span><span class="p">(</span><span class="n">fd</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">encrypt_file</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
</div>
<footer>
<div class="sharing">
</div>
</footer>
</article>
</div>
<aside class="sidebar col-md-3">
<section>
<h1>Levels</h2>
<div class="list-group">
<a class="list-group-item " href="/fusion/level00/">Level 00</a>
<a class="list-group-item " href="/fusion/level01/">Level 01</a>
<a class="list-group-item active" href="/fusion/level02/">Level 02</a>
<a class="list-group-item " href="/fusion/level03/">Level 03</a>
<a class="list-group-item " href="/fusion/level04/">Level 04</a>
<a class="list-group-item " href="/fusion/level05/">Level 05</a>
<a class="list-group-item " href="/fusion/level06/">Level 06</a>
<a class="list-group-item " href="/fusion/level07/">Level 07</a>
<a class="list-group-item " href="/fusion/level08/">Level 08</a>
<a class="list-group-item " href="/fusion/level09/">Level 09</a>
<a class="list-group-item " href="/fusion/level10/">Level 10</a>
<a class="list-group-item " href="/fusion/level11/">Level 11</a>
<a class="list-group-item " href="/fusion/level12/">Level 12</a>
<a class="list-group-item " href="/fusion/level13/">Level 13</a>
<a class="list-group-item " href="/fusion/level14/">Level 14</a>
</div>
</section>
</aside>
</div>
</div>
</div>
</div>
<footer role="contentinfo"><div class="container">
<p class="text-muted credits">
<div align="center">Copyright &copy; 2014 - Exploit Exercises</div>
</p>
</div>
</footer>
<script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>
<script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>
</body>
</html>
